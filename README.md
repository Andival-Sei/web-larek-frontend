# WEB-ларёк

Интернет-магазин с товарами для веб-разработчиков. В нём можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ.

## Используемый стек

- **TypeScript** - статическая типизация JavaScript
- **SCSS** - препроцессор CSS
- **Webpack** - сборщик модулей
- **ESLint** - линтер кода
- **Prettier** - форматтер кода

## Инструкция по сборке и запуску

### Установка зависимостей
```bash
npm install
```

### Создание файла окружения
Создайте файл `.env` в корне проекта со следующим содержимым:
```
API_ORIGIN=https://larek-api.nomoreparties.co
```

### Запуск в режиме разработки
```bash
npm run start
```

### Сборка проекта
```bash
npm run build
```

### Другие команды
- `npm run lint` - проверка кода линтером
- `npm run lint:fix` - автоматическое исправление ошибок линтера
- `npm run format` - форматирование кода

## Архитектура проекта

Проект реализован с использованием **MVP (Model-View-Presenter)** архитектуры с **Event-Driven** подходом.

### Основные принципы:
- **Единственная ответственность** - каждый класс решает только одну задачу
- **Слабое связывание** - компоненты взаимодействуют через события
- **Инверсия зависимостей** - зависимости передаются через конструктор
- **Композиция над наследованием** - переиспользование через композицию

### Структура проекта:
```
src/
├── components/          # Базовые классы и утилиты
│   ├── base/           # Базовые классы (Component, Model, API, Events)
│   └── api/            # API клиенты
├── models/             # Модели данных (Domain Layer)
├── views/              # Компоненты отображения (Presentation Layer)
├── types/              # Типы данных и интерфейсы
├── utils/              # Утилитарные функции и константы
└── index.ts            # Точка входа и связывание компонентов
```

## Базовые классы

### Component<T>
Базовый абстрактный класс для всех компонентов отображения.

**Назначение:** Предоставляет общие методы для работы с DOM-элементами.

**Функции:**
- `render(data?: T): HTMLElement` - рендеринг компонента с данными
- `setText(element, value)` - установка текстового содержимого
- `setImage(element, src, alt)` - установка изображения
- `setDisabled(element, state)` - управление состоянием блокировки
- `toggleClass(element, className, force)` - переключение CSS классов

### Model<T>
Базовый абстрактный класс для всех моделей данных.

**Назначение:** Обеспечивает единообразную работу с данными и событиями.

**Функции:**
- `emitChanges(event, payload)` - генерация событий об изменении модели

### Api
Базовый класс для работы с HTTP API.

**Назначение:** Предоставляет методы для выполнения HTTP-запросов.

**Функции:**
- `get(uri)` - GET запрос
- `post(uri, data, method)` - POST/PUT/DELETE запросы
- `handleResponse(response)` - обработка ответов сервера

### EventEmitter
Реализация паттерна "Наблюдатель" для связи компонентов.

**Назначение:** Обеспечивает слабое связывание между компонентами через события.

**Функции:**
- `on(event, callback)` - подписка на событие
- `emit(event, data)` - генерация события
- `off(event, callback)` - отписка от события

## Модели данных

### CatalogModel
Управляет каталогом товаров.

**Функции:**
- Хранение списка товаров
- Управление товаром для предпросмотра
- Загрузка товаров с сервера

**События:**
- `items:changed` - изменился список товаров
- `preview:changed` - изменился товар для предпросмотра

### BasketModel
Управляет корзиной покупок.

**Функции:**
- Добавление/удаление товаров
- Подсчет общей стоимости
- Проверка наличия товара в корзине

**События:**
- `basket:changed` - изменилось содержимое корзины

### OrderModel
Управляет данными заказа и их валидацией.

**Функции:**
- Управление полями формы заказа
- Валидация введенных данных
- Подготовка данных для отправки на сервер

**События:**
- `order:ready` - форма заказа готова к отправке
- `contacts:ready` - форма контактов готова к отправке
- `formErrors:change` - изменились ошибки валидации

## Компоненты отображения

### Page
Управляет главной страницей приложения.

**Функции:**
- Отображение каталога товаров
- Управление счетчиком товаров в корзине
- Блокировка прокрутки при открытых модальных окнах

### Modal
Управляет модальными окнами.

**Функции:**
- Открытие/закрытие модальных окон
- Установка содержимого модального окна
- Обработка кликов вне области содержимого

### Card
Универсальный компонент карточки товара.

**Варианты использования:**
- Карточка в каталоге
- Карточка предпросмотра товара
- Карточка товара в корзине

**Функции:**
- Отображение информации о товаре
- Обработка пользовательских действий
- Адаптация под разные контексты использования

### Basket
Компонент корзины покупок.

**Функции:**
- Отображение списка товаров в корзине
- Показ общей стоимости
- Управление состоянием кнопки оформления заказа

### Form<T>
Базовый компонент формы.

**Функции:**
- Обработка пользовательского ввода
- Валидация полей формы
- Отправка данных формы

### OrderForm
Форма выбора способа оплаты и адреса доставки.

**Наследует:** Form<IOrderForm>

**Дополнительные функции:**
- Управление кнопками выбора способа оплаты
- Валидация адреса доставки

### ContactsForm
Форма ввода контактной информации.

**Наследует:** Form<IContactsForm>

**Дополнительные функции:**
- Валидация email и телефона

### Success
Компонент успешного оформления заказа.

**Функции:**
- Отображение информации о списанной сумме
- Кнопка возврата к покупкам

## Типы данных

### Основные интерфейсы

```typescript
// Товар из API
interface IProduct {
    id: string;
    description: string;
    image: string;
    title: string;
    category: CategoryType;
    price: number | null;
}

// Заказ для отправки на сервер
interface IOrder {
    payment: PaymentMethod;
    address: string;
    email: string;
    phone: string;
    total: number;
    items: string[];
}
```

### Категории товаров
```typescript
type CategoryType = 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил';
```

### Способы оплаты
```typescript
type PaymentMethod = 'cash' | 'online';
```

## Взаимодействие компонентов

Компоненты взаимодействуют через события с использованием EventEmitter:

1. **View → Model**: Пользовательские действия генерируют события
2. **Model → View**: Изменения в моделях вызывают обновление представлений
3. **API**: Асинхронные запросы через WebLarekAPI класс

### Пример потока данных:
```
Клик по товару → card:select → CatalogModel.setPreview() → 
preview:changed → Показ модального окна с товаром
```

## API

### WebLarekAPI
Специализированный клиент для работы с API магазина.

**Наследует:** Api

**Методы:**
- `getProductList(): Promise<IProduct[]>` - получение списка товаров
- `getProduct(id: string): Promise<IProduct>` - получение товара по ID
- `createOrder(order: IOrder): Promise<IOrderResult>` - создание заказа

**Базовый URL:** `/api/weblarek`
**CDN URL:** `/content/weblarek` (для изображений)

## События приложения

### Товары и каталог
- `items:changed` - изменился список товаров
- `card:select` - выбран товар для просмотра
- `preview:changed` - изменился товар в режиме предпросмотра

### Корзина
- `card:add` - добавление товара в корзину
- `card:remove` - удаление товара из корзины
- `basket:open` - открытие корзины
- `basket:changed` - изменение содержимого корзины

### Заказ
- `order:open` - открытие формы заказа
- `order:submit` - отправка формы заказа
- `contacts:submit` - отправка формы контактов
- `order:success` - успешное создание заказа

### Формы
- `formErrors:change` - изменение ошибок валидации
- `order.{field}:change` - изменение поля формы заказа
- `contacts.{field}:change` - изменение поля формы контактов

### Модальные окна
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
