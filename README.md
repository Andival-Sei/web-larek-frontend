# Web-ларёк

Интернет-магазин магических товаров для веб-разработчиков. Проект реализован на **TypeScript** по паттерну **MVP** с событийным обменом. Пользователь может просмотреть каталог, положить товары в корзину и оформить заказ в два шага.

---

## 1. Используемый стек

| Цель | Технология |
|------|------------|
| Язык / типизация | **TypeScript 5** |
| Сборка | **Webpack 5**, `ts-loader`, `sass-loader` |
| Стили | **SCSS** + **PostCSS** (`autoprefixer`) |
| UI | HTML 5, семантические теги, flex / grid |
| Линтинг | **ESLint**, **Prettier** |
| Тесты (unit) | Jest (будущая доработка) |

Дополнительные пакеты перечислены в `package.json`.

---

## 2. Быстрый старт

1. Клонируйте репозиторий и установите зависимости

```bash
npm i
```

2. Создайте файл окружения `.env` в корне проекта

```dotenv
API_ORIGIN=https://larek-api.nomoreparties.co
```

3. Запустите режим разработки с hot-reload

```bash
npm run start
```

4. Соберите production-версию

```bash
npm run build
```

5. Полезные скрипты

* `npm run lint` — проверка ESLint;
* `npm run lint:fix` — авто-исправление;
* `npm run format` — форматирование Prettier.

---

## 3. Архитектура проекта

Проект разбит на три логических слоя: **Модели (Model)**, **Представления (View)** и **Презентер (Presenter)**. Связь между слоями осуществляется через общий **EventEmitter** – брокер событий, что обеспечивает слабое связывание и упрощает тестирование.

```
┌─────────┐     ui:click      ┌──────────────┐      model:changed      ┌────────────┐
│  View   │ ───────────────▶ │  Presenter   │ ──────────────────────▶ │   Model    │
└─────────┘ ◀─────────────── └──────────────┘ ◀────────────────────── └────────────┘
             render/update                         load / mutate
```

### 3.1 Базовые классы

| Класс | Расположение | Назначение |
|-------|--------------|------------|
| `EventEmitter` | `src/components/base/events.ts` | Регистрирует/снимает слушателей, рассылает события, передавая полезную нагрузку. |
| `Model<T>` | `src/components/base/Model.ts` | Абстрактная модель-обёртка поверх данных типа `T`. Предоставляет метод `emitChanges`, автоматически микширует `Partial<T>` в `this`. |
| `Component<P>` | `src/components/base/Component.ts` | Базовый класс представления: хранит ссылку на DOM-контейнер, умеет устанавливать текст, атрибуты, классы, изображения и реагировать на изм. свойств. |
| `WebLarekAPI` | `src/components/api/WebLarekAPI.ts` | Инкапсулирует HTTP-запросы (`fetch`). Методы: `getProducts`, `getProduct`, `createOrder`. |

### 3.2 Модели данных

| Класс | Описание |
|-------|----------|
| `CatalogModel` | Держит массив товаров, полученных из API. Предоставляет метод `getProduct(id)` для быстрого доступа к товару. |
| `BasketModel` | Хранит Map товаров, добавленных в корзину, считает итоговую сумму и количество. |
| `OrderModel` | Содержит промежуточные данные заказа (доставка, контакты), валидирует формы и формирует итоговый объект заказа. |

### 3.3 Представления (View-компоненты)

| Компонент | Файл | Функция |
|-----------|------|---------|
| `Card` | `src/views/Card.ts` | Карточка товара. Отображает инфо, выводит кнопку «Купить» / «Убрать». |
| `Basket` | `src/views/Basket.ts` | Список товаров в корзине + сумма + кнопка «Оформить». |
| `Modal` | `src/views/Modal.ts` | Универсальное модальное окно с анимацией и оверлеем. Закрывается по Esc, крестику, оверлею. |
| `Form` (базовый) | `src/views/Form.ts` | Общая логика форм: сбор данных, валидация, блокировка кнопок. |
| `OrderForm` | `src/views/OrderForm.ts` | Шаг 1: выбор оплаты + ввод адреса. |
| `ContactsForm` | `src/views/ContactsForm.ts` | Шаг 2: почта + телефон. |
| `Success` | `src/views/Success.ts` | Модалка успешной покупки. |
| `Page` | `src/views/Page.ts` | Шапка + основной контейнер. Отображает счётчик корзины. |

### 3.4 Взаимодействие компонентов

1. Пользователь кликает по `Card` → `Card` эмитит `card:select`.
2. `Presenter` (см. `src/index.ts`) ловит событие, открывает `Modal` с подробным описанием.
3. «Купить» → `Card` эмитит `card:add`; `BasketModel.add()` обновляет Map и шлёт `basket:changed`.
4. `Page` подписан на `basket:changed` и обновляет счётчик, `Basket` — перерисовывает список.
5. При оформлении `OrderForm` и `ContactsForm` сбрасывают валидность в `OrderModel` и активируют/деактивируют кнопки.
6. `OrderModel` собирает финальный объект и отдаёт `Presenter` → `WebLarekAPI.createOrder()`.

Диаграмму классов (PNG) можно найти в `docs/uml.png`.

---

## 4. Данные и типы

Все типы объявлены в `src/types`.

| Интерфейс | Назначение |
|-----------|------------|
| `IProduct` | Объект товара из API. |
| `ICard` | Данные, требуемые компоненту `Card`. |
| `IBasketItem` | Упрощённый товар в корзине. |
| `IOrderDelivery` / `IOrderContacts` | Шаги формы заказа. |
| `IOrder` | Финальный объект, отправляемый `POST /order`. |
| `IAppEvents` | Интерфейс словаря строковых констант всех внутренних событий. |

Используются строгие настройки TS (`strict`, `noImplicitAny`).

---

## 5. Процессы в приложении

1. **Загрузка каталога** – при инициализации `Presenter` вызывает `WebLarekAPI.getProducts`, передаёт данные в `CatalogModel`, которая шлёт `catalog:loaded`.
2. **Добавление в корзину** – `BasketModel` изменяет Map, `Basket` и `Page` перерисовываются.
3. **Оформление** – две формы наследуют `Form`, обмен данными идёт через `OrderModel`.
4. **Оплата** – `OrderModel` генерирует `IOrder`, API возвращает `id` + `total`, открывается `Success`.

Каждый шаг реализован через события; прямых ссылок Model ↔ View нет.

---

## 6. Структура репозитория

```
src/
├── components/            # базовые абстракции и api-клиент
│   └── base/              # Component, Model, events
├── models/                # бизнес-логика
├── views/                 # UI-компоненты (только отрисовка)
├── types/                 # декларации TS-типов
├── utils/                 # утилиты и константы
├── scss/                  # стили + переменные
└── index.ts               # точка входа / Presenter
```

---

## 7. Размещение в сети

Рабочая версия проекта доступна по ссылке: [https://web-larek-frontend-xi.vercel.app/](https://web-larek-frontend-xi.vercel.app/)

---

Проект выполнен в рамках курса **«TypeScript и ООП» (Яндекс Практикум)**.